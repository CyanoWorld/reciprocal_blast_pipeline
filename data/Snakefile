rule all:
	input:
		"reciprocal_best_hits_protein_ids.txt"

rule make_forward_database:
	input: "forward_genome/fw_prot_db.faa"
	output: "forward_genome/fw_prot_db.pdb"
	params: blast_out="forward_genome/fw_prot_db"
	shell: "makeblastdb -in {input} -dbtype prot -out {params.blast_out}"

rule forward_blast:
	input: query="query_sequences/input_forward.faa", db="forward_genome/fw_prot_db.pdb"
	output: "forward_blast_output.csv"
	params: blast_in="forward_genome/fw_prot_db.faa"
	shell: "blastp -db {params.blast_in} -query {input.query}  -outfmt 10 -word_size 3 -evalue 0.001000000000000 -num_alignments 10000 -out {output} "

rule get_backward_sequences:
	input: blast_results="forward_blast_output.csv", fw_genome="forward_genome/fw_prot_db.faa"
	output: "query_sequences/input_backward.faa"
	script: 
		"process_fw_blast_results.py"

rule make_backward_database:
	input: "backward_genome/bw_prot_db.faa"
	output: "backward_genome/bw_prot_db.pdb"
	params: blast_out="backward_genome/bw_prot_db"
	shell: "makeblastdb -in {input} -dbtype prot -out {params.blast_out}"

rule backward_blast:
	input: query="query_sequences/input_backward.faa", db="backward_genome/bw_prot_db.pdb"
	output: "backward_blast_output.csv"
	params: blast_in="backward_genome/bw_prot_db.faa"
	shell: "blastp -db {params.blast_in} -query {input.query}  -outfmt 10 -word_size 3 -evalue 0.001000000000000 -num_alignments 1 -out {output} "

rule get_reciprocal_best_hits_proteins_ids:
	input: bw_result="backward_blast_output.csv", fw_result="forward_blast_output.csv"
	output: "reciprocal_best_hits_protein_ids.txt"
	script: 
		"extract_valid_accession_ids_from_blast_results.py"

